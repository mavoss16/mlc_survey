church_exp_data <- long |> filter(question == "church_expectations_choice")
connection_data <- long |> filter(question == "connection_factors_choice")
music_data <- long |> filter(question == "music_styles_choice")
church_pri_data <- long |> filter(question == "church_priorities_choice")
# Use the same group name "survey"
shared_church_exp <- SharedData$new(church_exp_data, key = ~response_id, group = "long_survey")
shared_connection <- SharedData$new(connection_data, key = ~response_id, group = "long_survey")
shared_music <- SharedData$new(music_data, key = ~response_id, group = "long_survey")
shared_church_pri <- SharedData$new(church_pri_data, key = ~response_id, group = "long_survey")
multi_long <- clean |>
select(
response_id, age_range, service_attendance, church_association_length, all_of(data_names |> filter(multi_choice == TRUE) |> pull(new_name))
) |>
pivot_longer(cols = ends_with("choice"), names_to = "question", values_to = "response") |>
separate_longer_delim(response, ",") |>
group_by(question) |>
mutate(response = fct_infreq(response)) |>
arrange(response) |>
ungroup()
write_rds(clean, "survey_clean.rds")
write_rds(multi_long, "survey_multi_long.rds")
wide <- read_rds("survey_clean.rds")
long <- read_rds("survey_multi_long.rds")
shared_wide <- SharedData$new(wide, key = ~response_id)
shared_long <- SharedData$new(wide, key = ~response_id, group = "long_survey")
# Make sure long has the same id column (linked to wide)
# If long is derived from wide, carry over the id
church_exp_data <- long |> filter(question == "church_expectations_choice")
connection_data <- long |> filter(question == "connection_factors_choice")
music_data <- long |> filter(question == "music_styles_choice")
church_pri_data <- long |> filter(question == "church_priorities_choice")
# Use the same group name "survey"
shared_church_exp <- SharedData$new(church_exp_data, key = ~response_id, group = "long_survey")
shared_connection <- SharedData$new(connection_data, key = ~response_id, group = "long_survey")
shared_music <- SharedData$new(music_data, key = ~response_id, group = "long_survey")
shared_church_pri <- SharedData$new(church_pri_data, key = ~response_id, group = "long_survey")
install.packages("SummaryWidget")
?bslib::layout_sidebar
library(bslib)
?navset_bar
?str_wrap
stringi::stri_wrap("wlekf jwel kfjwlekf jwlekj lksjadflj welfkj")
stringi::stri_wrap("wlekf jwel kfjwlekf jwlekj lksjadflj welfkj wlkfjlwdkj flkjdfljs flkjwlekfj")
str_wrap("wlekf jwel kfjwlekf jwlekj lksjadflj welfkj wlkfjlwdkj flkjdfljs flkjwlekfj")
str_wrap("wlekf jwel kfjwlekf jwlekj lksjadflj welfkj wlkfjlwdkj flkjdfljs flkjwlekfj", width = 20)
title_wrap <- function(str, line_br = "\n", ...){
str_wrap(str, ...) |>
str_replace_all(pattern = "\\n", replacement = line_br)
}
title_wrap("wlekf jwel kfjwlekf jwlekj lksjadflj welfkj wlkfjlwdkj flkjdfljs flkjwlekfj", width = 20)
title_wrap("wlekf jwel kfjwlekf jwlekj lksjadflj welfkj wlkfjlwdkj flkjdfljs flkjwlekfj", width = 20, line_br = "<br>")
"Do you feel connected to the MLC community?" |> title_wrap(25)
"Do you feel connected to the MLC community?" |> title_wrap(width = 25)
title_wrap <- function(str, line_br = "<br>", ...){
str_wrap(str, ...) |>
str_replace_all(pattern = "\\n", replacement = line_br)
}
"Do you feel connected to the MLC community?" |> title_wrap(width = 25)
View(multi_long)
multi_long <- clean |>
select(
response_id, age_range, service_attendance, church_association_length, all_of(data_names |> filter(multi_choice == TRUE) |> pull(new_name))
) |>
pivot_longer(cols = ends_with("choice"), names_to = "question", values_to = "response") |>
separate_longer_delim(response, ",") |>
group_by(question) |>
mutate(response = fct_infreq(response)) |>
arrange(response) |>
ungroup()
multi_long <- clean |>
select(
response_id, age_range, service_attendance, church_association_length, all_of(data_names |> filter(multi_choice == TRUE) |> pull(new_name))
) |>
pivot_longer(cols = ends_with("choice"), names_to = "question", values_to = "response") |>
separate_longer_delim(response, ",") |>
group_by(question, response) |>
summarize(n = n()) |>
arrange(question, n) |>
ungroup()
multi_long <- clean |>
select(
response_id, age_range, service_attendance, church_association_length, all_of(data_names |> filter(multi_choice == TRUE) |> pull(new_name))
) |>
pivot_longer(cols = ends_with("choice"), names_to = "question", values_to = "response") |>
separate_longer_delim(response, ",") |>
group_by(question, response) |>
summarize(n = n()) |>
arrange(question, desc(n)) |>
ungroup()
multi_long <- clean |>
select(
response_id, age_range, service_attendance, church_association_length, all_of(data_names |> filter(multi_choice == TRUE) |> pull(new_name))
) |>
pivot_longer(cols = ends_with("choice"), names_to = "question", values_to = "response") |>
separate_longer_delim(response, ",") |>
group_by(question, response) |>
mutate(n = n()) |>
arrange(question, desc(n)) |>
ungroup()
write_rds(clean, "survey_clean.rds")
write_rds(multi_long, "survey_multi_long.rds")
wide <- read_rds("survey_clean.rds")
long <- read_rds("survey_multi_long.rds")
shared_wide <- SharedData$new(wide, key = ~response_id)
shared_long <- SharedData$new(wide, key = ~response_id, group = "long_survey")
# Make sure long has the same id column (linked to wide)
# If long is derived from wide, carry over the id
church_exp_data <- long |> filter(question == "church_expectations_choice")
connection_data <- long |> filter(question == "connection_factors_choice")
music_data <- long |> filter(question == "music_styles_choice")
church_pri_data <- long |> filter(question == "church_priorities_choice")
# Use the same group name "survey"
shared_church_exp <- SharedData$new(church_exp_data, key = ~response_id, group = "long_survey")
shared_connection <- SharedData$new(connection_data, key = ~response_id, group = "long_survey")
shared_music <- SharedData$new(music_data, key = ~response_id, group = "long_survey")
shared_church_pri <- SharedData$new(church_pri_data, key = ~response_id, group = "long_survey")
?navset_bar
?nav_panel
View(clean)
30 * 7
names(clean)
table_data <- clean |>
select(
response_id,
age_range, service_attendance, church_association_length,
church_mission_feeling, spiritually_fed, connected_to_community,
church_expectations, church_expectations_other, connection_factors_choice, connection_factors_other,
music_styles_choice, music_styles_other, church_priorities_choice, church_priorities_other,
youth_program_feedback, additional_thoughts
)
table_data <- clean |>
select(
response_id,
age_range, service_attendance, church_association_length,
church_mission_feeling, spiritually_fed, connected_to_community,
church_expectations_choice, church_expectations_other, connection_factors_choice, connection_factors_other,
music_styles_choice, music_styles_other, church_priorities_choice, church_priorities_other,
youth_program_feedback, additional_thoughts
)
data_names
names(data_names)
data_names$clean_name
data_names$full_name
names(table_data)[match(data_names[,"new_name"], names(table_data))] <- data_names[,"full_name"]
match(data_names[,"new_name"], names(table_data))
new_name %in% names(table_data)
data_names$new_name %in% names(table_data)
match(data_names[data_names$new_name %in% names(table_data),"new_name"], names(table_data))
names(table_data)[match(data_names[data_names$new_name %in% names(table_data),"new_name"], names(table_data))] <- data_names[data_names$new_name %in% names(table_data),"full_name"]
View(table_data)
write_rds(table_data, "table_data.rds")
table_data <- read_rds("table_data.rds")
?reactable
library(reactable)
?reactable
?colDef
class("lsfkj")
names(table_data)
table_data <- clean |>
select(
response_id,
age_range, service_attendance, church_association_length,
church_mission_feeling, spiritually_fed, connected_to_community,
church_expectations_choice, church_expectations_other, connection_factors_choice, connection_factors_other,
music_styles_choice, music_styles_other, church_priorities_choice, church_priorities_other,
youth_program_feedback, additional_thoughts
)
names(table_data) <- c(
"response_id",
"Age Range", "Primary Service", "Church Association Length",
"Church Mission Feeling", "Spiritually Fed", "MLC Community Connection",
"Church Expectations", "Church Expectations--Other", "Connection Factors", "Connection Factors--Other",
"Music Styles", "Music Styles-Other", "Church Priorities", "Church Priorities--Other",
"Youth Program Feedback", "Additional Feedback"
)
write_rds(table_data, "table_data.rds")
?colDef
table_data <- clean |>
select(
response_id,
age_range, service_attendance, church_association_length,
church_mission_feeling, spiritually_fed, connected_to_community,
church_expectations_choice, church_expectations_other, connection_factors_choice, connection_factors_other,
music_styles_choice, music_styles_other, church_priorities_choice, church_priorities_other,
youth_program_feedback, additional_thoughts
)
names(table_data) <- c(
"response_id",
"Age Range", "Primary Service", "Church Association Length",
"Church Mission Feeling", "Spiritually Fed", "MLC Community Connection",
"Church Expectations", "Church Expectations (Other)", "Connection Factors", "Connection Factors (Other)",
"Music Styles", "Music Styles-Other", "Church Priorities", "Church Priorities (Other)",
"Youth Program Feedback", "Additional Feedback"
)
# names(table_data)[match(data_names[data_names$new_name %in% names(table_data),"new_name"], names(table_data))] <- data_names[data_names$new_name %in% names(table_data),"full_name"]
write_rds(table_data, "table_data.rds")
?across
table_data <- clean |>
select(
response_id,
age_range, service_attendance, church_association_length,
church_mission_feeling, spiritually_fed, connected_to_community,
church_expectations_choice, church_expectations_other, connection_factors_choice, connection_factors_other,
music_styles_choice, music_styles_other, church_priorities_choice, church_priorities_other,
youth_program_feedback, additional_thoughts
) |>
mutate(
across(
where(is.character),
function(str){
str_replace(str, ",", ", ") |>
str_squish()
}
)
)
names(table_data) <- c(
"response_id",
"Age Range", "Primary Service", "Church Association Length",
"Church Mission Feeling", "Spiritually Fed", "MLC Community Connection",
"Church Expectations", "Church Expectations (Other)", "Connection Factors", "Connection Factors (Other)",
"Music Styles", "Music Styles-Other", "Church Priorities", "Church Priorities (Other)",
"Youth Program Feedback", "Additional Feedback"
)
View(table_data)
str_replace_all(str, ",", ", ") |>
str_squish()
table_data <- clean |>
select(
response_id,
age_range, service_attendance, church_association_length,
church_mission_feeling, spiritually_fed, connected_to_community,
church_expectations_choice, church_expectations_other, connection_factors_choice, connection_factors_other,
music_styles_choice, music_styles_other, church_priorities_choice, church_priorities_other,
youth_program_feedback, additional_thoughts
) |>
mutate(
across(
where(is.character),
function(str){
str_replace_all(str, ",", ", ") |>
str_squish()
}
)
)
names(table_data) <- c(
"response_id",
"Age Range", "Primary Service", "Church Association Length",
"Church Mission Feeling", "Spiritually Fed", "MLC Community Connection",
"Church Expectations", "Church Expectations (Other)", "Connection Factors", "Connection Factors (Other)",
"Music Styles", "Music Styles-Other", "Church Priorities", "Church Priorities (Other)",
"Youth Program Feedback", "Additional Feedback"
)
write_rds(table_data, "table_data.rds")
install.packages("tippy")
library(readr)
library(dplyr)
library(tidyr)
library(stringr)
library(forcats)
library(ggplot2)
library(ggfittext)
library(gt)
library(scales)
# Load data
wide <- read_rds("survey_clean.rds")
long <- read_rds("survey_multi_long.rds")
# Create age groups for comparison
wide <- wide |>
mutate(
age_group = case_when(
age_range %in% c("Under 20", "20-29", "30-39", "40-49") ~ "Under 50",
age_range %in% c("50-59", "60-69", "70-79", "80+") ~ "50 and Over",
TRUE ~ NA_character_
)
)
# Add age group to long data
long <- long |>
mutate(
age_group = case_when(
age_range %in% c("Under 20", "20-29", "30-39", "40-49") ~ "Under 50",
age_range %in% c("50-59", "60-69", "70-79", "80+") ~ "50 and Over",
TRUE ~ NA_character_
),
age_group = factor(age_group, levels = c("Under 50", "50 and Over"))
)
# Theme for plots
theme_set(theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(size = 11, face = "bold")
))
# Create summary table
demo_summary <- wide |>
summarise(
`Total Responses` = n(),
`Median Age Range` = median(as.numeric(age_range), na.rm = TRUE),
`Under 50` = sum(age_group == "Under 50", na.rm = TRUE),
`50 and Over` = sum(age_group == "50 and Over", na.rm = TRUE)
)
demo_summary |>
gt() |>
tab_header(
title = "Survey Response Summary"
) |>
fmt_number(
columns = everything(),
decimals = 0
)
wide |>
filter(!is.na(age_range)) |>
count(age_range) |>
mutate(
Percentage = percent(n / sum(n), accuracy = 0.1)
) |>
rename(
`Age Range` = age_range,
Count = n
) |>
gt() |>
tab_header(
title = "Age Distribution of Respondents"
)
wide |>
filter(!is.na(service_attendance)) |>
count(service_attendance) |>
mutate(
Percentage = percent(n / sum(n), accuracy = 0.1)
) |>
rename(
`Primary Service` = service_attendance,
Count = n
) |>
gt() |>
tab_header(
title = "Primary Service Attendance"
)
wide |>
filter(!is.na(church_association_length)) |>
count(church_association_length) |>
mutate(
Percentage = percent(n / sum(n), accuracy = 0.1)
) |>
rename(
`Association Length` = church_association_length,
Count = n
) |>
gt() |>
tab_header(
title = "Length of Church Association"
)
mission_data <- wide |>
filter(!is.na(church_mission_feeling)) |>
count(church_mission_feeling, .drop = FALSE)
n_responses <- sum(mission_data$n)
n_responses <- sum(mission_data$n)
mission_data |>
ggplot(aes(x = church_mission_feeling, y = n)) +
geom_col(fill = "steelblue") +
geom_fit_text(aes(label = n), place = "top", reflow = TRUE, grow = FALSE) +
labs(
title = sprintf("How do you feel about MLC's mission? (n=%d)", n_responses),
x = NULL,
y = "Count"
) +
theme(axis.text.x = element_text(size = 8))
?geom_fit_text
mission_data |>
ggplot(aes(x = church_mission_feeling, y = n)) +
geom_col(fill = "steelblue") +
geom_bar_text(aes(label = n)) +
# geom_fit_text(aes(label = n), place = "top", reflow = TRUE, grow = FALSE) +
labs(
title = sprintf("How do you feel about MLC's mission? (n=%d)", n_responses),
x = NULL,
y = "Count"
) +
theme(axis.text.x = element_text(size = 8))
mission_age_data <- wide |>
filter(!is.na(church_mission_feeling), !is.na(age_group)) |>
count(age_group, church_mission_feeling, .drop = FALSE)
mission_age_data |>
ggplot(aes(x = church_mission_feeling, y = n, fill = age_group)) +
geom_col(position = "dodge") +
geom_bar_text(aes(label = n)) +
facet_wrap(~age_group) +
labs(
title = "Mission Satisfaction by Age Group",
x = NULL,
y = "Count"
) +
theme(
legend.position = "none",
axis.text.x = element_text(size = 7)
) +
scale_fill_manual(values = c("Under 50" = "#4E79A7", "50 and Over" = "#F28E2B"))
?facet_wrap
library(readr)
library(dplyr)
library(tidyr)
library(stringr)
library(forcats)
library(ggplot2)
library(ggfittext)
library(gt)
library(scales)
# Load data
wide <- read_rds("survey_clean.rds")
long <- read_rds("survey_multi_long.rds")
# Create age groups for comparison
wide <- wide |>
mutate(
age_group = case_when(
age_range %in% c("Under 20", "20-29", "30-39", "40-49") ~ "Under 50",
age_range %in% c("50-59", "60-69", "70-79", "80+") ~ "50 and Over",
TRUE ~ NA_character_
)
)
# Add age group to long data
long <- long |>
mutate(
age_group = case_when(
age_range %in% c("Under 20", "20-29", "30-39", "40-49") ~ "Under 50",
age_range %in% c("50-59", "60-69", "70-79", "80+") ~ "50 and Over",
TRUE ~ NA_character_
),
age_group = factor(age_group, levels = c("Under 50", "50 and Over"))
)
# Theme for plots
theme_set(theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(size = 11, face = "bold")
))
# Create summary table
demo_summary <- wide |>
summarise(
`Total Responses` = n(),
`Median Age Range` = median(as.numeric(age_range), na.rm = TRUE),
`Under 50` = sum(age_group == "Under 50", na.rm = TRUE),
`50 and Over` = sum(age_group == "50 and Over", na.rm = TRUE)
)
demo_summary |>
gt() |>
tab_header(
title = "Survey Response Summary"
) |>
fmt_number(
columns = everything(),
decimals = 0
)
wide |>
filter(!is.na(age_range)) |>
count(age_range) |>
mutate(
Percentage = percent(n / sum(n), accuracy = 0.1)
) |>
rename(
`Age Range` = age_range,
Count = n
) |>
gt() |>
tab_header(
title = "Age Distribution of Respondents"
)
wide |>
filter(!is.na(service_attendance)) |>
count(service_attendance) |>
mutate(
Percentage = percent(n / sum(n), accuracy = 0.1)
) |>
rename(
`Primary Service` = service_attendance,
Count = n
) |>
gt() |>
tab_header(
title = "Primary Service Attendance"
)
wide |>
filter(!is.na(church_association_length)) |>
count(church_association_length) |>
mutate(
Percentage = percent(n / sum(n), accuracy = 0.1)
) |>
rename(
`Association Length` = church_association_length,
Count = n
) |>
gt() |>
tab_header(
title = "Length of Church Association"
)
mission_data <- wide |>
filter(!is.na(church_mission_feeling)) |>
count(church_mission_feeling, .drop = FALSE)
n_responses <- sum(mission_data$n)
mission_data |>
ggplot(aes(x = church_mission_feeling, y = n)) +
geom_col(fill = "steelblue") +
geom_bar_text(aes(label = n)) +
labs(
title = sprintf("How do you feel about MLC's mission? (n=%d)", n_responses),
x = NULL,
y = "Count"
) +
theme(axis.text.x = element_text(size = 8))
mission_age_data <- wide |>
filter(!is.na(church_mission_feeling), !is.na(age_group)) |>
count(age_group, church_mission_feeling, .drop = FALSE)
mission_age_data
str(mission_age_data)
wide$age_group
